<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Respuestas del Participante</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <h1>ğŸ“‹ Respuestas del Cuestionario</h1>
</header>

<nav>
    <a href="listaParticipantes.html">â¬…ï¸ Volver a la Lista</a>
</nav>

<main>
    <section id="infoParticipante">
        <h2>InformaciÃ³n del Participante</h2>
        <p><strong>ID:</strong> <span id="id"></span></p>
        <p><strong>Nombre:</strong> <span id="nombre"></span></p>
        <p><strong>RUT:</strong> <span id="rut"></span></p>
        <p><strong>Tipo:</strong> <span id="tipo"></span></p>
    </section>

    <section>
        <h2>ğŸ§  Cuestionario Respondido</h2>
        <div id="respuestasContainer"></div>
    </section>
</main>

<script>
    const apiParticipantes = "/api/participantes";
    const apiPreguntas = "/api/preguntas-encuesta";
    const apiRespuestas = "/api/dato-encuesta";

    async function obtenerParametro(nombre) {
      const params = new URLSearchParams(window.location.search);
      return params.get(nombre);
    }

    async function cargarDatos() {
      const id = await obtenerParametro("id");
      if (!id) {
        alert("âŒ No se proporcionÃ³ el ID del participante.");
        window.location.href = "listaParticipantes.html";
        return;
      }

      // ğŸ”¹ Obtener participante
      const resPart = await fetch(`${apiParticipantes}/${id}`);
      const participante = await resPart.json();
      document.querySelector("#id").textContent = participante.idParticipante;
      document.querySelector("#nombre").textContent = participante.nombre;
      document.querySelector("#rut").textContent = participante.rut;
      document.querySelector("#tipo").textContent = participante.esCaso ? "Caso" : "Control";

      // ğŸ”¹ Obtener preguntas y respuestas
      const [resPreg, resResp] = await Promise.all([
        fetch(apiPreguntas),
        fetch(apiRespuestas)
      ]);
      const preguntas = await resPreg.json();
      const respuestas = await resResp.json();

      // ğŸ”¹ Filtrar respuestas del participante actual
      const respuestasParticipante = respuestas.filter(r => r.idParticipante === id);

      const cont = document.querySelector("#respuestasContainer");
      cont.innerHTML = "";

      preguntas.forEach(p => {
        const r = respuestasParticipante.find(x => x.idPregunta === p.idPregunta);
        const textoRespuesta = r ? r.respuesta : "(Sin respuesta)";
        const div = document.createElement("div");
        div.classList.add("preguntaRespuesta");
        div.innerHTML = `
          <p><strong>${p.enunciado}</strong></p>
          <p class="respuesta">ğŸ—¨ï¸ ${textoRespuesta}</p>
          <hr>
        `;
        cont.appendChild(div);
      });
    }

    cargarDatos();
</script>
</body>
</html>
